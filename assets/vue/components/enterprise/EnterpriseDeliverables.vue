<template>
  <div class="enterprise-deliverables bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
    <!-- Header avec bouton toggle -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
      <div class="flex items-center">
        <span class="text-green-500 text-2xl mr-3">üì¶</span>
        <div>
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white">
            Section 4 : Livrables attendus & p√©rim√®tre
          </h4>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            D√©finissez ce qui est inclus dans le projet et les responsabilit√©s
          </p>
        </div>
      </div>
      <button
        @click="toggleExpanded"
        class="flex items-center space-x-2 px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors"
      >
        <span>{{ isExpanded ? 'R√©duire' : 'D√©velopper' }}</span>
        <svg
          :class="['w-4 h-4 transition-transform duration-200', isExpanded ? 'rotate-180' : '']"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
    </div>

    <!-- Contenu repliable -->
    <div :class="['expand-transition', isExpanded ? 'expanded' : 'collapsed']">
      <div class="p-6">
        <!-- Grid 3 colonnes pour les 3 premi√®res sections -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Gestion UI/UX -->
          <div>
            <h5 class="text-md font-medium text-gray-900 dark:text-white mb-4">
              üé® Gestion de l'UI/UX
            </h5>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
              Qui g√®re l'UI/UX du projet ?
            </label>
            <div class="space-y-3">
              <label class="flex items-start">
                <input
                  type="radio"
                  name="ui-ux-management"
                  value="internal"
                  v-model="localFormData.uiUxManagement"
                  @change="updateFormData"
                  class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <div class="ml-3">
                  <span class="font-medium text-gray-900 dark:text-white">G√©r√© en interne</span>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    Votre √©quipe design s'occupe de l'UI/UX
                  </p>
                </div>
              </label>

              <label class="flex items-start">
                <input
                  type="radio"
                  name="ui-ux-management"
                  value="external"
                  v-model="localFormData.uiUxManagement"
                  @change="updateFormData"
                  class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <div class="ml-3">
                  <span class="font-medium text-gray-900 dark:text-white">Prestataire externe</span>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    Agence ou freelance design externe
                  </p>
                </div>
              </label>

              <label class="flex items-start">
                <input
                  type="radio"
                  name="ui-ux-management"
                  value="included"
                  v-model="localFormData.uiUxManagement"
                  @change="updateFormData"
                  class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <div class="ml-3">
                  <span class="font-medium text-gray-900 dark:text-white">√Ä inclure dans le chiffrage</span>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    L'√©quipe de d√©veloppement g√®re aussi l'UI/UX
                  </p>
                </div>
              </label>
            </div>
          </div>

          <!-- Maquettes et sp√©cifications -->
          <div>
            <h5 class="text-md font-medium text-gray-900 dark:text-white mb-4">
              üìã Maquettes et sp√©cifications
            </h5>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                  Maquettes ou wireframes
                </label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="mockups"
                      value="available"
                      v-model="localFormData.mockupsStatus"
                      @change="updateFormData"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                    >
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      Disponibles
                    </span>
                  </label>
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="mockups"
                      value="to-create"
                      v-model="localFormData.mockupsStatus"
                      @change="updateFormData"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                    >
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      √Ä cr√©er
                    </span>
                  </label>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                  Sp√©cifications fonctionnelles
                </label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="specs"
                      value="detailed"
                      v-model="localFormData.specsStatus"
                      @change="updateFormData"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                    >
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      D√©taill√©es
                    </span>
                  </label>
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="specs"
                      value="basic"
                      v-model="localFormData.specsStatus"
                      @change="updateFormData"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                    >
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      Basiques
                    </span>
                  </label>
                  <label class="flex items-center">
                    <input
                      type="radio"
                      name="specs"
                      value="to-define"
                      v-model="localFormData.specsStatus"
                      @change="updateFormData"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                    >
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      √Ä d√©finir
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Communication avec le client final -->
          <div>
            <h5 class="text-md font-medium text-gray-900 dark:text-white mb-3">
              üí¨ Communication projet
            </h5>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
              Des r√©unions r√©guli√®res sont-elles pr√©vues avec le client final ?
            </label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input
                  type="radio"
                  name="client-meetings"
                  value="frequent"
                  v-model="localFormData.clientMeetings"
                  @change="updateFormData"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                  Oui, suivi r√©gulier pr√©vu
                </span>
              </label>
              <label class="flex items-center">
                <input
                  type="radio"
                  name="client-meetings"
                  value="milestone"
                  v-model="localFormData.clientMeetings"
                  @change="updateFormData"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                  Points d'√©tape uniquement
                </span>
              </label>
              <label class="flex items-center">
                <input
                  type="radio"
                  name="client-meetings"
                  value="minimal"
                  v-model="localFormData.clientMeetings"
                  @change="updateFormData"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                  Communication minimale
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- Sections suppl√©mentaires en pleine largeur -->
        <div class="mt-8 space-y-6">
          <!-- Services additionnels -->
          <div>
            <h5 class="text-md font-medium text-gray-900 dark:text-white mb-4">
              üöÄ Services additionnels
            </h5>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
              Quels services suppl√©mentaires doivent √™tre inclus dans le chiffrage ?
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <label v-for="service in additionalServices" :key="service.id" class="flex items-start">
                <input
                  type="checkbox"
                  :value="service.id"
                  v-model="localFormData.selectedServices"
                  @change="updateFormData"
                  class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <div class="ml-3">
                  <div class="flex items-center">
                    <span class="text-lg mr-2">{{ service.icon }}</span>
                    <span class="font-medium text-gray-900 dark:text-white">{{ service.name }}</span>
                  </div>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ service.description }}</p>
                </div>
              </label>
            </div>
          </div>

          <!-- Contraintes sp√©cifiques -->
          <div>
            <h5 class="text-md font-medium text-gray-900 dark:text-white mb-4">
              ‚ö†Ô∏è Contraintes sp√©cifiques
            </h5>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
              Y a-t-il des contraintes particuli√®res √† prendre en compte ?
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label v-for="constraint in specificConstraints" :key="constraint.id" class="flex items-start">
                <input
                  type="checkbox"
                  :value="constraint.id"
                  v-model="localFormData.selectedConstraints"
                  @change="updateFormData"
                  class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
                <div class="ml-3">
                  <div class="flex items-center">
                    <span class="text-lg mr-2">{{ constraint.icon }}</span>
                    <span class="font-medium text-gray-900 dark:text-white">{{ constraint.name }}</span>
                  </div>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ constraint.description }}</p>
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'EnterpriseDeliverables',
  props: {
    formData: {
      type: Object,
      default: () => ({
        uiUxManagement: '',
        mockupsStatus: '',
        specsStatus: '',
        clientMeetings: '',
        selectedServices: [],
        selectedConstraints: []
      })
    }
  },
  emits: ['update:form-data'],
  data() {
    return {
      isExpanded: false,
      localFormData: {
        uiUxManagement: '',
        mockupsStatus: '',
        specsStatus: '',
        clientMeetings: '',
        selectedServices: [],
        selectedConstraints: [],
        ...this.formData
      },
      additionalServices: [
        {
          id: 'deployment-only',
          name: 'D√©ploiement uniquement',
          description: 'Mise en production sur l\'environnement cible',
          icon: 'üöÄ'
        },
        {
          id: 'deployment-cicd',
          name: 'D√©ploiement & CI/CD',
          description: 'Pipeline d\'int√©gration et d√©ploiement continu',
          icon: 'üîÑ'
        },
        {
          id: 'monitoring',
          name: 'Monitoring',
          description: 'Surveillance applicative et infrastructure',
          icon: 'üìä'
        },
        {
          id: 'maintenance',
          name: 'Maintenance √©volutive',
          description: 'Support technique et √©volutions post-livraison',
          icon: 'üîß'
        },
        {
          id: 'sla-support',
          name: 'SLA ou support',
          description: 'Engagement de niveau de service et support',
          icon: 'üõ°Ô∏è'
        },
        {
          id: 'training',
          name: 'Formation √©quipe',
          description: 'Formation de l\'√©quipe client sur l\'outil',
          icon: 'üéì'
        }
      ],
      specificConstraints: [
        {
          id: 'tight-deadline',
          name: 'D√©lai tr√®s serr√©',
          description: 'Contrainte de temps importante n√©cessitant des ressources suppl√©mentaires',
          icon: '‚è∞'
        },
        {
          id: 'legacy-integration',
          name: 'Int√©gration syst√®me legacy',
          description: 'Connexion avec des syst√®mes anciens ou complexes',
          icon: 'üèõÔ∏è'
        },
        {
          id: 'high-availability',
          name: 'Haute disponibilit√©',
          description: 'Exigences de disponibilit√© 24/7 ou tr√®s √©lev√©es',
          icon: 'üîí'
        },
        {
          id: 'compliance',
          name: 'Conformit√© r√©glementaire',
          description: 'Respect de normes sp√©cifiques (RGPD, ISO, etc.)',
          icon: 'üìã'
        },
        {
          id: 'performance',
          name: 'Performance critique',
          description: 'Exigences de performance tr√®s √©lev√©es',
          icon: '‚ö°'
        },
        {
          id: 'multi-tenant',
          name: 'Architecture multi-tenant',
          description: 'Isolation des donn√©es entre plusieurs clients',
          icon: 'üè¢'
        }
      ]
    }
  },
  computed: {
    hasDeliverableData() {
      return this.localFormData.uiUxManagement ||
             this.localFormData.mockupsStatus ||
             this.localFormData.specsStatus ||
             this.localFormData.clientMeetings ||
             this.localFormData.selectedServices.length > 0 ||
             this.localFormData.selectedConstraints.length > 0;
    }
  },
  methods: {
    updateFormData() {
      this.$emit('update:form-data', { ...this.localFormData });
    },

    toggleExpanded() {
      this.isExpanded = !this.isExpanded;
    },

    getUiUxLabel() {
      const labels = {
        'internal': 'G√©r√© en interne',
        'external': 'Prestataire externe',
        'included': 'Inclus dans le chiffrage'
      };
      return labels[this.localFormData.uiUxManagement] || this.localFormData.uiUxManagement;
    },

    getMockupsLabel() {
      const labels = {
        'available': 'Disponibles',
        'to-create': '√Ä cr√©er'
      };
      return labels[this.localFormData.mockupsStatus] || this.localFormData.mockupsStatus;
    },

    getSpecsLabel() {
      const labels = {
        'detailed': 'D√©taill√©es',
        'basic': 'Basiques',
        'to-define': '√Ä d√©finir'
      };
      return labels[this.localFormData.specsStatus] || this.localFormData.specsStatus;
    },

    getClientMeetingsLabel() {
      const labels = {
        'frequent': 'Suivi r√©gulier pr√©vu',
        'milestone': 'Points d\'√©tape uniquement',
        'minimal': 'Communication minimale'
      };
      return labels[this.localFormData.clientMeetings] || this.localFormData.clientMeetings;
    }
  },
  watch: {
    formData: {
      handler(newData) {
        this.localFormData = { ...this.localFormData, ...newData };
      },
      deep: true
    }
  }
}
</script>
